# PBL ì‹¤ìŠµí˜• êµì¬ ë¬¸ì„œ (PCâ€“Pico ì—°ë™í˜•)

## 1. ì‹¤ìŠµ ì£¼ì œ

**ì›¹ì—ì„œ ì œì–´í•˜ëŠ” ì›ê²© LED ì¡°ëª… ì‹œìŠ¤í…œ êµ¬í˜„**


## 2. í”„ë¡œì íŠ¸ ê°œìš”

ì´ ì‹¤ìŠµì—ì„œëŠ” **PCì˜ ì›¹ ë¸Œë¼ìš°ì €**ì™€ **Raspberry Pi Pico W**ê°€
ì„œë¡œ í†µì‹ í•˜ì—¬ LED ë§¤íŠ¸ë¦­ìŠ¤ì˜ ìƒ‰ìƒì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì œì–´í•©ë‹ˆë‹¤.

* **PC (Flask ì„œë²„)** â†’ ì›¹ í˜ì´ì§€ì—ì„œ ìƒ‰ìƒ ì„ íƒ í›„ ì „ì†¡
* **Pico W (í´ë¼ì´ì–¸íŠ¸)** â†’ ìˆ˜ì‹ í•œ ë°ì´í„°ë¥¼ LED ìƒ‰ìƒìœ¼ë¡œ í‘œì‹œ

ì¦‰, Flask ì›¹ ì„œë²„ë¥¼ í†µí•´ ì‚¬ìš©ìê°€ ì›¹ ì¸í„°í˜ì´ìŠ¤ì—ì„œ ìƒ‰ì„ ì„ íƒí•˜ë©´,
ê·¸ ì •ë³´ê°€ Picoì— ì „ë‹¬ë˜ì–´ **ì¡°ëª… ìƒ‰ìƒì´ ì¦‰ì‹œ ë°”ë€ŒëŠ” êµ¬ì¡°**ì…ë‹ˆë‹¤.

## 3. ì„ í–‰ ì‘ì—…

(ì´ê³³ì— Flask ì„¤ì¹˜ ë° Python í™˜ê²½ ì¤€ë¹„ ê³¼ì •ì„ ê¸°ìˆ í•˜ì„¸ìš”.)
ğŸ“‹ ì˜ˆì‹œ: â€œFlask ì„¤ì¹˜ ëª…ë ¹ì–´â€, â€œPython ê°€ìƒí™˜ê²½ ì„¤ì •â€, â€œMQTT ë¸Œë¡œì»¤ ì ‘ì† í…ŒìŠ¤íŠ¸â€ ë“±

## 4. ê°œë… ì„¤ëª… â€” **Flask ì›¹ ì„œë²„ êµ¬ì¡° ì´í•´í•˜ê¸°**

**Flaskë€?**
FlaskëŠ” íŒŒì´ì¬ ê¸°ë°˜ì˜ **ê²½ëŸ‰ ì›¹ í”„ë ˆì„ì›Œí¬**ë¡œ,
ë³µì¡í•œ ì„¤ì • ì—†ì´ ë¹ ë¥´ê²Œ ì›¹ ì„œë²„ì™€ APIë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì£¼ìš” íŠ¹ì§•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

* **ë¼ìš°íŒ… (Routing):**
  `@app.route()` ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•´ URLê³¼ í•¨ìˆ˜ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.
  ì˜ˆ:

  ```python
  @app.route("/")
  def index():
      return "Hello Flask!"
  ```

* **í…œí”Œë¦¿ ë Œë”ë§ (HTML í‘œì‹œ):**
  `render_template()` í•¨ìˆ˜ë¥¼ ì´ìš©í•´ HTML íŒŒì¼ì„ í´ë¼ì´ì–¸íŠ¸ì— ì „ì†¡í•©ë‹ˆë‹¤.
  HTML íŒŒì¼ì€ ê¸°ë³¸ì ìœ¼ë¡œ `templates/` í´ë”ì— ì €ì¥ë©ë‹ˆë‹¤.

* **ìš”ì²­ ì²˜ë¦¬ (Request Handling):**
  GET, POST ë“± HTTP ìš”ì²­ì„ ì²˜ë¦¬í•˜ë©°,
  `request.form`ì´ë‚˜ `request.args`ë¥¼ í†µí•´ ì‚¬ìš©ìì˜ ì…ë ¥ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

* **ì„œë²„ ì‹¤í–‰:**
  FlaskëŠ” ë‚´ë¶€ ê°œë°œìš© ì„œë²„ë¥¼ ë‚´ì¥í•˜ê³  ìˆìœ¼ë©°,
  ë‹¤ìŒê³¼ ê°™ì´ ê°„ë‹¨íˆ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  ```python
  if __name__ == "__main__":
      app.run(host="0.0.0.0", port=5000)
  ```

ì´ë²ˆ ì‹¤ìŠµì—ì„œëŠ” Flaskê°€ ì›¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë‹´ë‹¹í•˜ê³ ,
ìƒ‰ìƒ ê°’ì„ ì…ë ¥ë°›ì•„ MQTTë¥¼ í†µí•´ Picoë¡œ ì „ì†¡í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.
ì¦‰, FlaskëŠ” **ì‚¬ìš©ìì™€ í•˜ë“œì›¨ì–´ ì‚¬ì´ì˜ ë‹¤ë¦¬(Bridge)** ì—­í• ì„ í•©ë‹ˆë‹¤.

## 5. Pico ì½”ë“œ

```python
from ticle import WifiManager
from umqtt.simple2 import MQTTClient
from ticle.ext import WS2812Matrix
import utime

MATRIX_W=16; MATRIX_H=16
TOPIC=b"ticle/ws2812/color"

led_matrix=WS2812Matrix([(3,1)])
led_matrix.clear()

def fill_color_hex(hex_string):
    if len(hex_string)==7 and hex_string[0]==35:
        r=int(hex_string[1:3],16)
        g=int(hex_string[3:5],16)
        b=int(hex_string[5:7],16)
        for y in range(MATRIX_H):
            for x in range(MATRIX_W):
                led_matrix[x,y]=(r,g,b)
        led_matrix.update()

def on_message(topic,msg,retained,dup):
    fill_color_hex(msg)

wifi=WifiManager()
wifi.connect("HBE_RSP","hanback91!")

mqtt_client=MQTTClient("pico_ws2812","test.mosquitto.org",port=1883)
mqtt_client.set_callback(on_message)
mqtt_client.connect()
mqtt_client.subscribe(TOPIC)

while True:
    mqtt_client.check_msg()
    utime.sleep_ms(20)
```

## 6. PC ì½”ë“œ

```python
from flask import Flask, render_template, request, make_response
import paho.mqtt.client as mqtt
import os

BROKER = "test.mosquitto.org"
PORT = 1883
TOPIC = "ticle/ws2812/color"

client = mqtt.Client(client_id=f"pc_ws2812_{os.getpid()}", clean_session=True)
client.connect(BROKER, PORT, 60)
client.loop_start()

app = Flask(__name__)

@app.route("/", methods=["GET"])
def index():
    return render_template("index.html")

@app.route("/set", methods=["POST"])
def set_color():
    color_value = request.form.get("color", "").strip()
    if not color_value.startswith("#") or len(color_value) != 7:
        return make_response("Invalid color format", 400)
    client.publish(TOPIC, payload=color_value.encode(), qos=0, retain=False)
    return "ok"

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)
```


### ğŸ§  (A) Pico ì½”ë“œ ìš”ì•½

* `WifiManager`ë¥¼ í†µí•´ ë¬´ì„  ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°
* MQTT í´ë¼ì´ì–¸íŠ¸ë¡œ `test.mosquitto.org` ë¸Œë¡œì»¤ êµ¬ë…
* ìˆ˜ì‹  ë©”ì‹œì§€(ìƒ‰ìƒ ì½”ë“œ)ë¥¼ í•´ì„í•˜ì—¬ LED ë§¤íŠ¸ë¦­ìŠ¤ ìƒ‰ìƒ ë³€ê²½
* 20ms ê°„ê²©ìœ¼ë¡œ ì§€ì†ì ìœ¼ë¡œ ë©”ì‹œì§€ ì²´í¬

### ğŸ’» (B) PC ì½”ë“œ ìš”ì•½

* **Flask ì„œë²„ êµ¬ì„±:**
  `/` ê²½ë¡œì—ì„œ HTML í˜ì´ì§€ë¥¼ í‘œì‹œí•˜ê³ ,
  `/set` ê²½ë¡œì—ì„œ POST ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
* **ìƒ‰ìƒ ì²˜ë¦¬ íë¦„:**

  1. ì›¹ í˜ì´ì§€ì—ì„œ ìƒ‰ìƒ(`#RRGGBB`)ì„ ì„ íƒ
  2. `/set`ë¡œ POST ì „ì†¡
  3. Flaskê°€ ê°’ì„ ê²€ì¦ í›„ MQTTë¡œ ì „ì†¡
* **ì„œë²„ ì‹¤í–‰:**
  `app.run()`ìœ¼ë¡œ 5000ë²ˆ í¬íŠ¸ì—ì„œ ì›¹ ì„œë²„ ì‹¤í–‰

## 8. ê²°ê³¼ í™•ì¸

ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ìƒ‰ìƒì„ ì„ íƒí•˜ê³  â€œì „ì†¡â€ì„ ëˆ„ë¥´ë©´,
Picoì˜ WS2812 LED ë§¤íŠ¸ë¦­ìŠ¤ê°€ ë™ì¼í•œ ìƒ‰ìœ¼ë¡œ ë³€í•©ë‹ˆë‹¤.
PCì—ì„œ ì›¹ UIë¥¼ í†µí•´ **ì‹¤ì‹œê°„ìœ¼ë¡œ ì¡°ëª… ìƒ‰ìƒì„ ì›ê²© ì œì–´**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ“¸ **ì‚¬ì§„ / ìŠ¤í¬ë¦°ìƒ· ì‚½ì… ìœ„ì¹˜ (ì›¹ UI, LED í‘œì‹œ ê²°ê³¼)**
(ì—¬ê¸°ì— Flask ì›¹ í˜ì´ì§€ì™€ Pico LED ë§¤íŠ¸ë¦­ìŠ¤ì˜ ê²°ê³¼ ì‚¬ì§„ì„ ì²¨ë¶€í•˜ì„¸ìš”.)

## 9. ì—°ìŠµë¬¸ì œ

1. ì›¹ í˜ì´ì§€ì— ì—¬ëŸ¬ ìƒ‰ìƒ ë²„íŠ¼(ì˜ˆ: â€œRedâ€, â€œGreenâ€, â€œBlueâ€)ì„ ì¶”ê°€í•´ë³´ì„¸ìš”.
2. ìƒ‰ìƒ ë³€ê²½ ì‹œ, LED ë§¤íŠ¸ë¦­ìŠ¤ì˜ ë°ê¸°ë‚˜ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.
3. ì›¹ í˜ì´ì§€ì— â€œëª¨ë‘ ë„ê¸°â€ ë²„íŠ¼ì„ ì¶”ê°€í•˜ì—¬ LEDë¥¼ ì „ì²´ ì†Œë“±í•˜ëŠ” ê¸°ëŠ¥ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.
